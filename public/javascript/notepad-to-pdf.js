document.getElementById('saveNoteBtn').onclick = () => {
    // Extract the HTML content generated by Quill
    const quillContent = document.querySelector('#editor-container .ql-editor').innerHTML;

    // EXTRACT NOTE TITLE
    const title = document.getElementById('noteTitleInput');

    // Create a wrapper element to style the content
    const wrapper = document.createElement('div');
    wrapper.innerHTML = quillContent;

    // Find all images and resize them
    const images = wrapper.querySelectorAll('img');
    images.forEach(img => {
        img.style.maxWidth = '75%';
        img.style.maxHeight = '300px'; // Limit image height
        img.style.height = 'auto'; // Maintain aspect ratio
        img.style.objectFit = 'contain'; // Adjust the image inside its box
        img.style.alignSelf = 'center';
    });

    // Set up PDF rendering options
    const options = {
        margin: [12, 10, 10, 10],
        filename: 'document.pdf',
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    // Wait for images to load before generating PDF
    const imagePromises = Array.from(images).map(img => {
        return new Promise(resolve => {
            if (img.complete) resolve(); // Already loaded
            else {
                img.onload = resolve;
                img.onerror = resolve;
            }
        });
    });

    Promise.all(imagePromises).then(() => {
        html2pdf()
            .from(wrapper)
            .set(options)
            .toPdf()
            .get('pdf') // Access the jsPDF instance
            .then((pdf) => {
                // Total number of pages
                const totalPages = pdf.internal.getNumberOfPages();
    
                // LOOP THROUGH ALL PAGES TO ADD PAGE NUMBERING.
                for (let i = 1; i <= totalPages; i++) {
                    pdf.setPage(i);
                    pdf.setFontSize(10); // FONT SIZE OF THE FOOTER AND HEADER;
                    // ADD A FOOTER
                    pdf.text(`Page ${i} of ${totalPages}`, pdf.internal.pageSize.width - 20, pdf.internal.pageSize.height - 10, { align: 'right' });
                    // ADD A HEADER;
                    pdf.text(title.value, pdf.internal.pageSize.width / 2, 10, { align: 'center' });

                }
            })
            .save(); // Save the final PDF
    })           

};
